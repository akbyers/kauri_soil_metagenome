#!/bin/bash -e

#SBATCH --account       lincoln03750
#SBATCH --job-name      calculate_gene_coverage
#SBATCH --time          7-00:00:00
#SBATCH --mem           50GB
#SBATCH --cpus-per-task 5
#SBATCH --error         %x_%j.err
#SBATCH --output        %x_%j.out
#SBATCH --mail-user     alexa.byers@lincoln.ac.nz
#SBATCH --mail-type     ALL

#Working directory
cd /scale_wlg_nobackup/filesets/nobackup/lincoln03750/MGS_RDF/CO_ASSEMBLY
#mkdir bin_coverage

#Step 1: Concat all MAGS into single fasta file
cat deReplicated_FINAL_BINS/deReplicated_contigs/*_.fa > deReplicated_FINAL_BINS/deReplicated_contigs/concatenated_MAGs.fasta

#Step 2: remove duplicate reads using dedupe.sh script
# Load modules
module purge
module load BBMap/39.01-GCC-11.3.0

dedupe.sh in=deReplicated_FINAL_BINS/deReplicated_contigs/concatenated_MAGs.fasta out=deReplicated_FINAL_BINS/deReplicated_contigs/DEDUPE_concatenated_MAGs.fasta

#Step 3: build the index for Bowtie2

# Load modules
module purge
module load Bowtie2/2.4.5-GCC-11.3.0 
module load SAMtools/1.15.1-GCC-11.3.0

#Build bowtie index
#bowtie2-build deReplicated_FINAL_BINS/dedupe_contigs/DEDUPE_MAGs_edited.fasta bin_coverage/bw_bins

#Step 4: Run Bowtie2 to map paired end metagenomic reads back to index of concatenated bins
#GLENFERN
#bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_10_1.fastq -2 ../raw_data_ALL/GF_10_2.fastq -S bin_coverage/GF_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_1_1.fastq -2 ../raw_data_ALL/GF_1_2.fastq -S bin_coverage/GF_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_2_1.fastq -2 ../raw_data_ALL/GF_2_2.fastq -S bin_coverage/GF_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_3_1.fastq -2 ../raw_data_ALL/GF_3_2.fastq -S bin_coverage/GF_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_4_1.fastq -2 ../raw_data_ALL/GF_4_2.fastq -S bin_coverage/GF_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_5_1.fastq -2 ../raw_data_ALL/GF_5_2.fastq -S bin_coverage/GF_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_6_1.fastq -2 ../raw_data_ALL/GF_6_2.fastq -S bin_coverage/GF_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_7_1.fastq -2 ../raw_data_ALL/GF_7_2.fastq -S bin_coverage/GF_7.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_8_1.fastq -2 ../raw_data_ALL/GF_8_2.fastq -S bin_coverage/GF_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GF_9_1.fastq -2 ../raw_data_ALL/GF_9_2.fastq -S bin_coverage/GF_9.sam

#convert to BAM
#samtools sort -@ 5 -o bin_coverage/GF_10.bam bin_coverage/GF_10.sam
samtools sort -@ 5 -o bin_coverage/GF_1.bam bin_coverage/GF_1.sam
samtools sort -@ 5 -o bin_coverage/GF_2.bam bin_coverage/GF_2.sam
samtools sort -@ 5 -o bin_coverage/GF_3.bam bin_coverage/GF_3.sam
samtools sort -@ 5 -o bin_coverage/GF_4.bam bin_coverage/GF_4.sam
samtools sort -@ 5 -o bin_coverage/GF_5.bam bin_coverage/GF_5.sam
samtools sort -@ 5 -o bin_coverage/GF_6.bam bin_coverage/GF_6.sam
samtools sort -@ 5 -o bin_coverage/GF_7.bam bin_coverage/GF_7.sam
samtools sort -@ 5 -o bin_coverage/GF_8.bam bin_coverage/GF_8.sam
samtools sort -@ 5 -o bin_coverage/GF_9.bam bin_coverage/GF_9.sam
rm bin_coverage/GF_*.sam

#GADGIL
#bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_10_1.fastq -2 ../raw_data_ALL/GG_10_2.fastq -S bin_coverage/GG_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_1_1.fastq -2 ../raw_data_ALL/GG_1_2.fastq -S bin_coverage/GG_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_2_1.fastq -2 ../raw_data_ALL/GG_2_2.fastq -S bin_coverage/GG_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_3_1.fastq -2 ../raw_data_ALL/GG_3_2.fastq -S bin_coverage/GG_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_4_1.fastq -2 ../raw_data_ALL/GG_4_2.fastq -S bin_coverage/GG_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_5_1.fastq -2 ../raw_data_ALL/GG_5_2.fastq -S bin_coverage/GG_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_6_1.fastq -2 ../raw_data_ALL/GG_6_2.fastq -S bin_coverage/GG_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_7_1.fastq -2 ../raw_data_ALL/GG_7_2.fastq -S bin_coverage/GG_7.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_8_1.fastq -2 ../raw_data_ALL/GG_8_2.fastq -S bin_coverage/GG_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/GG_9_1.fastq -2 ../raw_data_ALL/GG_9_2.fastq -S bin_coverage/GG_9.sam

#convert to BAM
#samtools sort -@ 5 -o bin_coverage/GG_10.bam bin_coverage/GG_10.sam
samtools sort -@ 5 -o bin_coverage/GG_1.bam bin_coverage/GG_1.sam
samtools sort -@ 5 -o bin_coverage/GG_2.bam bin_coverage/GG_2.sam
samtools sort -@ 5 -o bin_coverage/GG_3.bam bin_coverage/GG_3.sam
samtools sort -@ 5 -o bin_coverage/GG_4.bam bin_coverage/GG_4.sam
samtools sort -@ 5 -o bin_coverage/GG_5.bam bin_coverage/GG_5.sam
samtools sort -@ 5 -o bin_coverage/GG_6.bam bin_coverage/GG_6.sam
samtools sort -@ 5 -o bin_coverage/GG_7.bam bin_coverage/GG_7.sam
samtools sort -@ 5 -o bin_coverage/GG_8.bam bin_coverage/GG_8.sam
samtools sort -@ 5 -o bin_coverage/GG_9.bam bin_coverage/GG_9.sam
rm bin_coverage/GG_*.sam

#HIRAKIMATA
#bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_10_1.fastq -2 ../raw_data_ALL/HM_10_2.fastq -S bin_coverage/HM_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_1_1.fastq -2 ../raw_data_ALL/HM_1_2.fastq -S bin_coverage/HM_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_2_1.fastq -2 ../raw_data_ALL/HM_2_2.fastq -S bin_coverage/HM_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_3_1.fastq -2 ../raw_data_ALL/HM_3_2.fastq -S bin_coverage/HM_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_4_1.fastq -2 ../raw_data_ALL/HM_4_2.fastq -S bin_coverage/HM_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_5_1.fastq -2 ../raw_data_ALL/HM_5_2.fastq -S bin_coverage/HM_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_6_1.fastq -2 ../raw_data_ALL/HM_6_2.fastq -S bin_coverage/HM_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_7_1.fastq -2 ../raw_data_ALL/HM_7_2.fastq -S bin_coverage/HM_7.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_8_1.fastq -2 ../raw_data_ALL/HM_8_2.fastq -S bin_coverage/HM_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/HM_9_1.fastq -2 ../raw_data_ALL/HM_9_2.fastq -S bin_coverage/HM_9.sam

#convert to BAM
#samtools sort -@ 5 -o bin_coverage/HM_10.bam bin_coverage/HM_10.sam
samtools sort -@ 5 -o bin_coverage/HM_1.bam bin_coverage/HM_1.sam
samtools sort -@ 5 -o bin_coverage/HM_2.bam bin_coverage/HM_2.sam
samtools sort -@ 5 -o bin_coverage/HM_3.bam bin_coverage/HM_3.sam
samtools sort -@ 5 -o bin_coverage/HM_4.bam bin_coverage/HM_4.sam
samtools sort -@ 5 -o bin_coverage/HM_5.bam bin_coverage/HM_5.sam
samtools sort -@ 5 -o bin_coverage/HM_6.bam bin_coverage/HM_6.sam
samtools sort -@ 5 -o bin_coverage/HM_7.bam bin_coverage/HM_7.sam
samtools sort -@ 5 -o bin_coverage/HM_8.bam bin_coverage/HM_8.sam
samtools sort -@ 5 -o bin_coverage/HM_9.bam bin_coverage/HM_9.sam
rm bin_coverage/HM_*.sam

#KAIARAARA
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_10_1.fastq -2 ../raw_data_ALL/KA_10_2.fastq -S bin_coverage/KA_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_1_1.fastq -2 ../raw_data_ALL/KA_1_2.fastq -S bin_coverage/KA_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_2_1.fastq -2 ../raw_data_ALL/KA_2_2.fastq -S bin_coverage/KA_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_3_1.fastq -2 ../raw_data_ALL/KA_3_2.fastq -S bin_coverage/KA_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_4_1.fastq -2 ../raw_data_ALL/KA_4_2.fastq -S bin_coverage/KA_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_5_1.fastq -2 ../raw_data_ALL/KA_5_2.fastq -S bin_coverage/KA_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_6_1.fastq -2 ../raw_data_ALL/KA_6_2.fastq -S bin_coverage/KA_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_7_1.fastq -2 ../raw_data_ALL/KA_7_2.fastq -S bin_coverage/KA_7.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_8_1.fastq -2 ../raw_data_ALL/KA_8_2.fastq -S bin_coverage/KA_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/KA_9_1.fastq -2 ../raw_data_ALL/KA_9_2.fastq -S bin_coverage/KA_9.sam

#convert to BAM
samtools sort -@ 5 -o bin_coverage/KA_10.bam bin_coverage/KA_10.sam
samtools sort -@ 5 -o bin_coverage/KA_1.bam bin_coverage/KA_1.sam
samtools sort -@ 5 -o bin_coverage/KA_2.bam bin_coverage/KA_2.sam
samtools sort -@ 5 -o bin_coverage/KA_3.bam bin_coverage/KA_3.sam
samtools sort -@ 5 -o bin_coverage/KA_4.bam bin_coverage/KA_4.sam
samtools sort -@ 5 -o bin_coverage/KA_5.bam bin_coverage/KA_5.sam
samtools sort -@ 5 -o bin_coverage/KA_6.bam bin_coverage/KA_6.sam
samtools sort -@ 5 -o bin_coverage/KA_7.bam bin_coverage/KA_7.sam
samtools sort -@ 5 -o bin_coverage/KA_8.bam bin_coverage/KA_8.sam
samtools sort -@ 5 -o bin_coverage/KA_9.bam bin_coverage/KA_9.sam
rm bin_coverage/KA_*.sam

#LAINGHOLM
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_10_1.fastq -2 ../raw_data_ALL/La_10_2.fastq -S bin_coverage/La_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_11_1.fastq -2 ../raw_data_ALL/La_11_2.fastq -S bin_coverage/La_11.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_1_1.fastq -2 ../raw_data_ALL/La_1_2.fastq -S bin_coverage/La_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_13_1.fastq -2 ../raw_data_ALL/La_13_2.fastq -S bin_coverage/La_13.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_15_1.fastq -2 ../raw_data_ALL/La_15_2.fastq -S bin_coverage/La_15.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_2_1.fastq -2 ../raw_data_ALL/La_2_2.fastq -S bin_coverage/La_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_3_1.fastq -2 ../raw_data_ALL/La_3_2.fastq -S bin_coverage/La_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_4_1.fastq -2 ../raw_data_ALL/La_4_2.fastq -S bin_coverage/La_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_5_1.fastq -2 ../raw_data_ALL/La_5_2.fastq -S bin_coverage/La_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_6_1.fastq -2 ../raw_data_ALL/La_6_2.fastq -S bin_coverage/La_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_8_1.fastq -2 ../raw_data_ALL/La_8_2.fastq -S bin_coverage/La_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/La_9_1.fastq -2 ../raw_data_ALL/La_9_2.fastq -S bin_coverage/La_9.sam

#convert to BAM
samtools sort -@ 5 -o bin_coverage/La_10.bam bin_coverage/La_10.sam
samtools sort -@ 5 -o bin_coverage/La_11.bam bin_coverage/La_11.sam
samtools sort -@ 5 -o bin_coverage/La_1.bam bin_coverage/La_1.sam
samtools sort -@ 5 -o bin_coverage/La_13.bam bin_coverage/La_13.sam
samtools sort -@ 5 -o bin_coverage/La_15.bam bin_coverage/La_15.sam
samtools sort -@ 5 -o bin_coverage/La_2.bam bin_coverage/La_2.sam
samtools sort -@ 5 -o bin_coverage/La_3.bam bin_coverage/La_3.sam
samtools sort -@ 5 -o bin_coverage/La_4.bam bin_coverage/La_4.sam
samtools sort -@ 5 -o bin_coverage/La_5.bam bin_coverage/La_5.sam
samtools sort -@ 5 -o bin_coverage/La_6.bam bin_coverage/La_6.sam
samtools sort -@ 5 -o bin_coverage/La_8.bam bin_coverage/La_8.sam
samtools sort -@ 5 -o bin_coverage/La_9.bam bin_coverage/La_9.sam
rm bin_coverage/La_*.sam

#ORATIA
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_10_1.fastq -2 ../raw_data_ALL/Ora_10_2.fastq -S bin_coverage/Ora_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_12_1.fastq -2 ../raw_data_ALL/Ora_12_2.fastq -S bin_coverage/Ora_12.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_13_1.fastq -2 ../raw_data_ALL/Ora_13_2.fastq -S bin_coverage/Ora_13.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_14_1.fastq -2 ../raw_data_ALL/Ora_14_2.fastq -S bin_coverage/Ora_14.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_8_1.fastq -2 ../raw_data_ALL/Ora_8_2.fastq -S bin_coverage/Ora_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Ora_9_1.fastq -2 ../raw_data_ALL/Ora_9_2.fastq -S bin_coverage/Ora_9.sam

#convert to BAM
samtools sort -@ 5 -o bin_coverage/Ora_10.bam bin_coverage/Ora_10.sam
samtools sort -@ 5 -o bin_coverage/Ora_12.bam bin_coverage/Ora_12.sam
samtools sort -@ 5 -o bin_coverage/Ora_13.bam bin_coverage/Ora_13.sam
samtools sort -@ 5 -o bin_coverage/Ora_14.bam bin_coverage/Ora_14.sam
samtools sort -@ 5 -o bin_coverage/Ora_8.bam bin_coverage/Ora_8.sam
samtools sort -@ 5 -o bin_coverage/Ora_9.bam bin_coverage/Ora_9.sam
rm bin_coverage/Ora_*.sam

#PUKETI
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk10_1.fastq -2 ../raw_data_ALL/Puk10_2.fastq -S bin_coverage/Puk10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk11_1.fastq -2 ../raw_data_ALL/Puk11_2.fastq -S bin_coverage/Puk11.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk12_1.fastq -2 ../raw_data_ALL/Puk12_2.fastq -S bin_coverage/Puk12.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk15_1.fastq -2 ../raw_data_ALL/Puk15_2.fastq -S bin_coverage/Puk15.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk19_1.fastq -2 ../raw_data_ALL/Puk19_2.fastq -S bin_coverage/Puk19.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk21_1.fastq -2 ../raw_data_ALL/Puk21_2.fastq -S bin_coverage/Puk21.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk22_1.fastq -2 ../raw_data_ALL/Puk22_2.fastq -S bin_coverage/Puk22.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk5_1.fastq -2 ../raw_data_ALL/Puk5_2.fastq -S bin_coverage/Puk5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk6_1.fastq -2 ../raw_data_ALL/Puk6_2.fastq -S bin_coverage/Puk6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/Puk9_1.fastq -2 ../raw_data_ALL/Puk9_2.fastq -S bin_coverage/Puk9.sam

#convert to BAM
samtools sort -@ 5 -o bin_coverage/Puk10.bam bin_coverage/Puk10.sam
samtools sort -@ 5 -o bin_coverage/Puk11.bam bin_coverage/Puk11.sam
samtools sort -@ 5 -o bin_coverage/Puk12.bam bin_coverage/Puk12.sam
samtools sort -@ 5 -o bin_coverage/Puk15.bam bin_coverage/Puk15.sam
samtools sort -@ 5 -o bin_coverage/Puk19.bam bin_coverage/Puk19.sam
samtools sort -@ 5 -o bin_coverage/Puk21.bam bin_coverage/Puk21.sam
samtools sort -@ 5 -o bin_coverage/Puk22.bam bin_coverage/Puk22.sam
samtools sort -@ 5 -o bin_coverage/Puk5.bam bin_coverage/Puk5.sam
samtools sort -@ 5 -o bin_coverage/Puk6.bam bin_coverage/Puk6.sam
samtools sort -@ 5 -o bin_coverage/Puk9.bam bin_coverage/Puk9.sam
rm bin_coverage/Puk*.sam

#SILVERDALE
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_11_1.fastq -2 ../raw_data_ALL/SD_11_2.fastq -S bin_coverage/SD_11.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_12_1.fastq -2 ../raw_data_ALL/SD_12_2.fastq -S bin_coverage/SD_12.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_1_1.fastq -2 ../raw_data_ALL/SD_1_2.fastq -S bin_coverage/SD_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_13_1.fastq -2 ../raw_data_ALL/SD_13_2.fastq -S bin_coverage/SD_13.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_14_1.fastq -2 ../raw_data_ALL/SD_14_2.fastq -S bin_coverage/SD_14.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_15_1.fastq -2 ../raw_data_ALL/SD_15_2.fastq -S bin_coverage/SD_15.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_2_1.fastq -2 ../raw_data_ALL/SD_2_2.fastq -S bin_coverage/SD_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_3_1.fastq -2 ../raw_data_ALL/SD_3_2.fastq -S bin_coverage/SD_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_4_1.fastq -2 ../raw_data_ALL/SD_4_2.fastq -S bin_coverage/SD_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_5_1.fastq -2 ../raw_data_ALL/SD_5_2.fastq -S bin_coverage/SD_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_6_1.fastq -2 ../raw_data_ALL/SD_6_2.fastq -S bin_coverage/SD_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/SD_9_1.fastq -2 ../raw_data_ALL/SD_9_2.fastq -S bin_coverage/SD_9.sam

#convert to BAM
samtools sort -@ 5 -o bin_coverage/SD_11.bam bin_coverage/SD_11.sam
samtools sort -@ 5 -o bin_coverage/SD_12.bam bin_coverage/SD_12.sam
samtools sort -@ 5 -o bin_coverage/SD_1.bam bin_coverage/SD_1.sam
samtools sort -@ 5 -o bin_coverage/SD_13.bam bin_coverage/SD_13.sam
samtools sort -@ 5 -o bin_coverage/SD_14.bam bin_coverage/SD_14.sam
samtools sort -@ 5 -o bin_coverage/SD_15.bam bin_coverage/SD_15.sam
samtools sort -@ 5 -o bin_coverage/SD_2.bam bin_coverage/SD_2.sam
samtools sort -@ 5 -o bin_coverage/SD_3.bam bin_coverage/SD_3.sam
samtools sort -@ 5 -o bin_coverage/SD_4.bam bin_coverage/SD_4.sam
samtools sort -@ 5 -o bin_coverage/SD_5.bam bin_coverage/SD_5.sam
samtools sort -@ 5 -o bin_coverage/SD_6.bam bin_coverage/SD_6.sam
samtools sort -@ 5 -o bin_coverage/SD_9.bam bin_coverage/SD_9.sam
rm bin_coverage/SD_*.sam

#WINDY HILL
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_10_1.fastq -2 ../raw_data_ALL/WH_10_2.fastq -S bin_coverage/WH_10.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_1_1.fastq -2 ../raw_data_ALL/WH_1_2.fastq -S bin_coverage/WH_1.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_2_1.fastq -2 ../raw_data_ALL/WH_2_2.fastq -S bin_coverage/WH_2.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_3_1.fastq -2 ../raw_data_ALL/WH_3_2.fastq -S bin_coverage/WH_3.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_4_1.fastq -2 ../raw_data_ALL/WH_4_2.fastq -S bin_coverage/WH_4.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_5_1.fastq -2 ../raw_data_ALL/WH_5_2.fastq -S bin_coverage/WH_5.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_6_1.fastq -2 ../raw_data_ALL/WH_6_2.fastq -S bin_coverage/WH_6.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_7_1.fastq -2 ../raw_data_ALL/WH_7_2.fastq -S bin_coverage/WH_7.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_8_1.fastq -2 ../raw_data_ALL/WH_8_2.fastq -S bin_coverage/WH_8.sam
bowtie2 --minins 200 --maxins 800 --threads 5 --sensitive -x bin_coverage/bw_bins -1 ../raw_data_ALL/WH_9_1.fastq -2 ../raw_data_ALL/WH_9_2.fastq -S bin_coverage/WH_9.sam

#Convert to BAM files
samtools sort -@ 5 -o bin_coverage/WH_10.bam bin_coverage/WH_10.sam
samtools sort -@ 5 -o bin_coverage/WH_1.bam bin_coverage/WH_1.sam
samtools sort -@ 5 -o bin_coverage/WH_2.bam bin_coverage/WH_2.sam
samtools sort -@ 5 -o bin_coverage/WH_3.bam bin_coverage/WH_3.sam
samtools sort -@ 5 -o bin_coverage/WH_4.bam bin_coverage/WH_4.sam
samtools sort -@ 5 -o bin_coverage/WH_5.bam bin_coverage/WH_5.sam
samtools sort -@ 5 -o bin_coverage/WH_6.bam bin_coverage/WH_6.sam
samtools sort -@ 5 -o bin_coverage/WH_7.bam bin_coverage/WH_7.sam
samtools sort -@ 5 -o bin_coverage/WH_8.bam bin_coverage/WH_8.sam
samtools sort -@ 5 -o bin_coverage/WH_9.bam bin_coverage/WH_9.sam
rm bin_coverage/WH_*.sam

#Step 5: generate the per-sample coverage table for each contig in each bin via MetaBAT's jgi_summarize_bam_contig_depths
module purge
module load MetaBAT/2.15-GCC-11.3.0

# calculate coverage table
jgi_summarize_bam_contig_depths --outputDepth bin_coverage/bins_cov_table.txt bin_coverage/*.bam